<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>sports-home documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css" media="(prefers-color-scheme: dark)">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">sports-home documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li
  >
  leagueDetails</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/sports/soccer/league/league.component.ts</code>
        </p>




        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#amountTeams" 
>
                                            amountTeams
                                        </a>
                                </li>
                                <li>
                                        <a href="#gameday" 
>
                                            gameday
                                        </a>
                                </li>
                                <li>
                                        <a href="#gamedays" 
>
                                            gamedays
                                        </a>
                                </li>
                                <li>
                                        <a href="#gamesPerGameday" 
>
                                            gamesPerGameday
                                        </a>
                                </li>
                                <li>
                                        <a href="#hasPenalties" 
>
                                            hasPenalties
                                        </a>
                                </li>
                                <li>
                                        <a href="#leagueId" 
>
                                            leagueId
                                        </a>
                                </li>
                                <li>
                                        <a href="#leagueName" 
>
                                            leagueName
                                        </a>
                                </li>
                                <li>
                                        <a href="#penalties" 
>
                                            penalties
                                        </a>
                                </li>
                                <li>
                                        <a href="#season" 
>
                                            season
                                        </a>
                                </li>
                                <li>
                                        <a href="#specialPos" 
>
                                            specialPos
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="amountTeams"></a>
                                        <span class="name "><b>amountTeams</b>
                                            <a href="#amountTeams">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>amountTeams:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="gameday"></a>
                                        <span class="name "><b>gameday</b>
                                            <a href="#gameday">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>gameday:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="gamedays"></a>
                                        <span class="name "><b>gamedays</b>
                                            <a href="#gamedays">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>gamedays:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="gamesPerGameday"></a>
                                        <span class="name "><b>gamesPerGameday</b>
                                            <a href="#gamesPerGameday">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>gamesPerGameday:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="hasPenalties"></a>
                                        <span class="name "><b>hasPenalties</b>
                                            <a href="#hasPenalties">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>hasPenalties:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="leagueId"></a>
                                        <span class="name "><b>leagueId</b>
                                            <a href="#leagueId">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>leagueId:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="leagueName"></a>
                                        <span class="name "><b>leagueName</b>
                                            <a href="#leagueName">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>leagueName:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="penalties"></a>
                                        <span class="name "><b>penalties</b>
                                            <a href="#penalties">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>penalties:     <code>Array&lt;literal type&gt;</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>Array&lt;literal type&gt;</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="season"></a>
                                        <span class="name "><b>season</b>
                                            <a href="#season">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>season:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="specialPos"></a>
                                        <span class="name "><b>specialPos</b>
                                            <a href="#specialPos">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>specialPos:     <code>Array&lt;string&gt;</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>Array&lt;string&gt;</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Component, OnDestroy, OnInit } from &#x27;@angular/core&#x27;;
import { ActivatedRoute, Router } from &#x27;@angular/router&#x27;;
import { Subscription } from &#x27;rxjs&#x27;;

import { take } from &#x27;rxjs/operators&#x27;;
import { GamesService } from &#x27;src/app/shared/games.service&#x27;;
import { LeagueInfoService } from &#x27;src/app/shared/league-info.service&#x27;;

export interface leagueDetails {
  leagueName: string,
  season: string,
  leagueId: number,
  gameday: number,
  gamedays: number,
  amountTeams: number,
  gamesPerGameday: number,
  specialPos: Array&lt;string&gt;,
  penalties: Array&lt;{ team: string, points: number }&gt;,
  hasPenalties: boolean
}

@Component({
  selector: &#x27;app-league&#x27;,
  templateUrl: &#x27;./league.component.html&#x27;,
  styleUrls: [&#x27;./league.component.scss&#x27;],
})
export class LeagueComponent implements OnInit, OnDestroy {
  changedStandings: any &#x3D; [];
  previousStandings: any &#x3D; [];
  standings: any &#x3D; [];
  games: any &#x3D; [];
  allGames: any &#x3D; [];
  allSeasonGames: any &#x3D; {};

  leagueDetails: leagueDetails &#x3D; {
    leagueName: &#x27;&#x27;,
    season: &#x27;&#x27;,
    leagueId: 0,
    gameday: 0,
    gamedays: 0,
    amountTeams: 0,
    gamesPerGameday: 0,
    specialPos: [&#x27;&#x27;],
    penalties: [{ team: &#x27;&#x27;, points: 0 }],
    hasPenalties: false
  };

  showMatchDetails &#x3D; false;

  initialCall &#x3D; true;

  routeSubscription!: Subscription;
  currentTeamSubscription!: Subscription;
  currentMatchDetailsSubscription!: Subscription;

  constructor(
    private route: ActivatedRoute,
    private router: Router,
    private gamesService: GamesService,
    private leagueInfoService: LeagueInfoService
  ) { }

  /**
   * Initialises the website with checking the route and subscribes to value changes of the variable to show or not show the match details.
   */
  ngOnInit(): void {
    this.checkForRoute();
    // this.getStatus();
    this.changeSelectedTeams();

    this.currentMatchDetailsSubscription &#x3D; this.gamesService.currentShowMatchDetails.subscribe((data) &#x3D;&gt; {
      this.showMatchDetails &#x3D; data;
    });
  }

  /**
   * Checks for the route to display the correct league.
   */
  checkForRoute() {
    this.routeSubscription &#x3D; this.route.params.subscribe((params) &#x3D;&gt; {
      if (params[&#x27;name&#x27;]) {
        this.leagueDetails.leagueName &#x3D; params[&#x27;name&#x27;];
      } else {
        this.leagueDetails.leagueName &#x3D; &#x27;soccer-ger-1-2020&#x27;;
      }
      this.getLeagueInfo();
    });
  }

  /**
   * Initiates the function to fetch the league info to the database.
   */
  fetchLeagueInfo() {
    this.leagueInfoService.fetchLeagueInfo();
  }

  /**
   * Gets the league details to display the characteristics of this league.
   */
  getLeagueInfo() {
    this.leagueInfoService.leagueDetails.leagueName &#x3D;
      this.leagueDetails.leagueName;
    this.leagueInfoService
      .getLeagueInfo()
      .pipe(take(1))
      .subscribe((data) &#x3D;&gt; {
        this.leagueDetails &#x3D; data;
        this.leagueDetails.season &#x3D; this.leagueDetails.leagueName.slice(-4);
        this.initialCall &#x3D; true;
        this.gamesService.leagueDetails &#x3D; this.leagueDetails;
        this.leagueInfoService.leagueDetails &#x3D; this.leagueDetails;
        this.getTeams();
        // this.fetchTeams();
        // this.fetchGames();
      });
  }

  /**
   * Initiates the function to get the status for the data API to see how many requests have already been made today.
   */
  getStatus() {
    this.gamesService.getStatus();
  }

  /**
   * Initiates the function to fetch the teams from this league to the database.
   */
  fetchTeams() {
    this.gamesService
      .fetchTeams()
      .pipe(take(1))
      .subscribe((responseData) &#x3D;&gt; {
        console.log(responseData);
      });
  }

  /**
   * Initiates the function to fetch the games from this league to the database.
   */
  fetchGames() {
    this.gamesService
      .fetchGames()
      .pipe(take(1))
      .subscribe((responseData) &#x3D;&gt; {
        console.log(responseData);
      });
  }

  /**
   * Sets all goals to null, so that it looks like the league&#x27;s season would have not been played (yet).
   */
  setAllGoalsToNull() {
    for (let i &#x3D; 0; i &lt; Object.keys(this.allSeasonGames).length; i++) {
      const gameday &#x3D; this.allSeasonGames[i];
      for (const game of gameday) {
        game.halftimeHome &#x3D; null;
        game.halftimeAway &#x3D; null;
        game.fulltimeHome &#x3D; null;
        game.fulltimeAway &#x3D; null;
      }
    }
    this.gamesService.updateAllSeasonGames(this.allSeasonGames);
  }

  /**
   * Gets the teams for this league&#x27;s season from the database or the local storage if available.
   */
  getTeams() {
    if (localStorage.getItem(&#x60;${this.leagueDetails.leagueName}-teams&#x60;)) {
      this.standings &#x3D; JSON.parse(
        localStorage.getItem(&#x60;${this.leagueDetails.leagueName}-teams&#x60;) || &#x27;&#x27;
      );
      this.showMatchDetails &#x3D; false;
      this.getAllGames();
    } else {
      this.gamesService
        .getTeams()
        .pipe(take(1))
        .subscribe((standings) &#x3D;&gt; {
          this.standings &#x3D; standings;
          localStorage.setItem(
            &#x60;${this.leagueDetails.leagueName}-teams&#x60;,
            JSON.stringify(this.standings)
          );
          this.getAllGames();
        });
    }
  }

  /**
   * Gets the games of one gameday from the array which contains all games of this league&#x27;s season.
   */
  getGames() {
    this.games &#x3D; [];

    for (let i &#x3D; 0; i &lt; this.allGames[this.leagueDetails.gameday - 1].length; i++) {
      this.games.push(this.allGames[this.leagueDetails.gameday - 1][i]);
    }
    this.showMatchDetails &#x3D; false;
    this.gamesService.updateGames(this.games);
  }

  /**
   * Gets the games for this league&#x27;s season from the database or the local storage if available.
   */
  getAllGames() {
    if (localStorage.getItem(&#x60;${this.leagueDetails.leagueName}-games&#x60;)) {
      this.allSeasonGames &#x3D; JSON.parse(
        localStorage.getItem(&#x60;${this.leagueDetails.leagueName}-games&#x60;) || &#x27;&#x27;
      );
      if (this.initialCall) {
        this.determineGameday();
        this.initialCall &#x3D; false;
      } else {
        this.processAllGames();
      }
    } else {
      console.log(&#x27;From FB&#x27;);
      this.gamesService
        .getAllSeasonGames()
        .pipe(take(1))
        .subscribe((allSeasonGamesData) &#x3D;&gt; {
          this.allSeasonGames &#x3D; allSeasonGamesData;
          if (this.initialCall) {
            this.determineGameday();
            this.initialCall &#x3D; false;
          } else {
            this.processAllGames();
          }
        });
    }
  }

  /**
   * Checks when the next game is and shows the gameday right before
   */
  determineGameday() {
    let currentDate &#x3D; new Date().getTime();
    for (let i &#x3D; 0; i &lt; Object.keys(this.allSeasonGames).length; i++) {
      if (this.allSeasonGames[i][0].date &gt; currentDate) {
        if (i &gt; 0) {
          this.leagueDetails.gameday &#x3D; i;
        } else {
          this.leagueDetails.gameday &#x3D; 1;
        }
        break;
      }
    }
    this.processAllGames();
  }

  /**
   * Gets all games of this league&#x27;s season from gameday one until the currently selected gameday.
   */
  processAllGames() {
    this.allGames &#x3D; [];
    for (let i &#x3D; 0; i &lt; this.leagueDetails.gameday; i++) {
      this.allGames.push(this.allSeasonGames[i]);
    }
    this.gamesService.updateAllGames(this.allGames);
    this.gamesService.updateAllSeasonGames(this.allSeasonGames);
    this.getGames();
    this.setStandingsToZero();
    this.calculateStandings();
  }

  /**
   * Sets all standings values to zero so that the standings can be calculated again from zero.
   */
  setStandingsToZero() {
    for (let i &#x3D; 0; i &lt; this.standings.length; i++) {
      this.standings[i].gamesPlayed &#x3D; 0;
      this.standings[i].wins &#x3D; 0;
      this.standings[i].draws &#x3D; 0;
      this.standings[i].losses &#x3D; 0;
      this.standings[i].gf &#x3D; 0;
      this.standings[i].ga &#x3D; 0;
      this.standings[i].gd &#x3D; 0;
      this.standings[i].points &#x3D; 0;
    }
    this.gamesService.updateStandings(this.standings);
  }

  /**
   * Changes the selected team in the standings so that you can see which two teams in the standings are currently shown in match details
   */
  changeSelectedTeams() {
    this.currentTeamSubscription &#x3D;
      this.gamesService.currentTeamsSource.subscribe((data) &#x3D;&gt; {
        for (let i &#x3D; 0; i &lt; this.standings.length; i++) {
          const element &#x3D; this.standings[i];

          if (element.team &#x3D;&#x3D;&#x3D; this.games[data].home) {
            this.standings[i].current &#x3D; &#x27;home&#x27;;
          } else if (element.team &#x3D;&#x3D;&#x3D; this.games[data].away) {
            this.standings[i].current &#x3D; &#x27;away&#x27;;
          } else {
            this.standings[i].current &#x3D; &#x27;&#x27;;
          }
        }
      });
  }

  /**
   * Calculates the standings depending on how the games ended, skips games without a valid result and sorts them afterwads.
   */
  calculateStandings() {
    for (let i &#x3D; 0; i &lt; this.allGames.length; i++) {
      if (i &gt;&#x3D; this.leagueDetails.gamedays) {
        continue;
      }
      const gameday &#x3D; this.allGames[i];
      for (const game of gameday) {
        if (game.fulltimeHome &#x3D;&#x3D;&#x3D; null) {
          continue;
        }
        if (game.fulltimeHome &gt; game.fulltimeAway) {
          this.calculateStandingsValues(game.home, 1, 1, 0, 0, game.fulltimeHome, 3, game.away, 1, 0, 0, 1, game.fulltimeAway, 0);
        } else if (game.fulltimeHome &lt; game.fulltimeAway) {
          this.calculateStandingsValues(game.home, 1, 0, 0, 1, game.fulltimeHome, 0, game.away, 1, 1, 0, 0, game.fulltimeAway, 3);
        } else {
          this.calculateStandingsValues(game.home, 1, 0, 1, 0, game.fulltimeHome, 1, game.away, 1, 0, 1, 0, game.fulltimeAway, 1);
        }
      }
      if (i &#x3D;&#x3D;&#x3D; this.allGames.length - 2) {
        this.previousStandings &#x3D; JSON.parse(JSON.stringify(this.standings)); // Bad performance but best non third party solution I found
        this.calculateGoalDifferenceAndPenalties(this.previousStandings);
      }
    }
    if (this.allGames.length &lt; 2) {
      this.previousStandings &#x3D; JSON.parse(JSON.stringify(this.standings)); // Bad performance but best non third party solution I found
      this.calculateGoalDifferenceAndPenalties(this.previousStandings);
    }
    this.calculateGoalDifferenceAndPenalties(this.standings);
    this.sortStandings();
  }

  /**
   * Calculates the goal difference and penalties if applicable for the passed standings
   *
   * @param {any} selectedStandings - The standings for which this should be calculated
   */
  calculateGoalDifferenceAndPenalties(selectedStandings: any) {
    for (let i &#x3D; 0; i &lt; selectedStandings.length; i++) {
      const element &#x3D; selectedStandings[i];
      selectedStandings[i].gd &#x3D; element.gf - element.ga;
    }
    if (this.leagueDetails.hasPenalties) {
      for (const penalty of this.leagueDetails.penalties) {
        for (const team of selectedStandings) {
          if (team.team &#x3D;&#x3D;&#x3D; penalty.team) {
            team.points -&#x3D; penalty.points;
            break;
          }
        }
      }
    }
  }

  /**
   * Sorts the standings and previous standings checks if it&#x27;s gameday 1.
   */
  sortStandings() {
    this.previousStandings.sort(function (a: any, b: any) {
      return b.points - a.points || b.gd - a.gd || b.gf - a.gf || a.team.localeCompare(b.team);
    });

    this.standings.sort(function (a: any, b: any) {
      return b.points - a.points || b.gd - a.gd || b.gf - a.gf || a.team.localeCompare(b.team);
    });

    this.gamesService.updateStandings(this.standings);

    if (this.leagueDetails.gameday &gt; 1) {
      this.checkForStandingsChanges();
    } else {
      for (let i &#x3D; 0; i &lt; this.standings.length; i++) {
        this.changedStandings[i] &#x3D; 0;
      }
    }
  }

  /**
   * It checks how the team changed from the gameday before to this gameday and saves this in the changedStandings array.
   */
  checkForStandingsChanges() {
    this.changedStandings &#x3D; [];
    for (let i &#x3D; 0; i &lt; this.standings.length; i++) {
      const place &#x3D; this.standings[i];
      if (place.team !&#x3D;&#x3D; this.previousStandings[i].team) {
        for (let j &#x3D; 0; j &lt; this.previousStandings.length; j++) {
          const element &#x3D; this.previousStandings[j];
          const team &#x3D; place.team;
          if (element.team &#x3D;&#x3D;&#x3D; team) {
            this.changedStandings[i] &#x3D; j - i;
            break;
          }
        }
      }
      else {
        this.changedStandings[i] &#x3D; 0;
      }
    }
  }

  /**
   * Changes the values in the standings for the specific teams.
   *
   * @param {string} hName - The home team&#x27;s name
   * @param {number} hGP - The home team&#x27;s change of games played
   * @param {number} hW - The home team&#x27;s change of wins
   * @param {number} hD - The home team&#x27;s change of draws
   * @param {number} hL - The home team&#x27;s change of losses
   * @param {number} hG - The home team&#x27;s change of goals scored
   * @param {number} hP - The home team&#x27;s change of points
   * @param {string} aName - The away team&#x27;s name
   * @param {number} aGP - The away team&#x27;s change of games played
   * @param {number} aW - The away team&#x27;s change of wins
   * @param {number} aD - The away team&#x27;s change of draws
   * @param {number} aL - The away team&#x27;s change of losses
   * @param {number} aG - The away team&#x27;s change of goals scored
   * @param {number} aP - The away team&#x27;s change of points
   */
  calculateStandingsValues(
    hName: string, hGP: number, hW: number, hD: number, hL: number, hG: number, hP: number,
    aName: string, aGP: number, aW: number, aD: number, aL: number, aG: number, aP: number
  ) {
    for (let i &#x3D; 0; i &lt; this.standings.length; i++) {
      const element &#x3D; this.standings[i];
      if (element.team &#x3D;&#x3D;&#x3D; hName) {
        this.standings[i].gamesPlayed +&#x3D; hGP;
        this.standings[i].wins +&#x3D; hW;
        this.standings[i].draws +&#x3D; hD;
        this.standings[i].losses +&#x3D; hL;
        this.standings[i].gf +&#x3D; hG;
        this.standings[i].ga +&#x3D; aG;
        this.standings[i].points +&#x3D; hP;
      } else if (element.team &#x3D;&#x3D;&#x3D; aName) {
        this.standings[i].gamesPlayed +&#x3D; aGP;
        this.standings[i].wins +&#x3D; aW;
        this.standings[i].draws +&#x3D; aD;
        this.standings[i].losses +&#x3D; aL;
        this.standings[i].gf +&#x3D; aG;
        this.standings[i].ga +&#x3D; hG;
        this.standings[i].points +&#x3D; aP;
      }
    }
  }

  /**
   * Changes the standings value after a game&#x27;s result has changed depending on how the game result was before and how it is now and sorts the standings again.
   * This is a huge function because it checks many different game outcomes.
   *
   * @param {number} index - The gameday index of the game
   * @param {number} homeGoals - The new amount of goals the home team scored
   * @param {number} awayGoals - The new amount of goals the away team scored
   */
  changeStandings(index: number, homeGoals: number, awayGoals: number) {
    if (homeGoals &lt; 0 || awayGoals &lt; 0) {
      return;
    }
    const game &#x3D; this.games[index];
    if (game.fulltimeHome &gt; game.fulltimeAway &amp;&amp; game.fulltimeAway !&#x3D; null) {
      if (homeGoals &lt; awayGoals &amp;&amp; homeGoals !&#x3D; null) {
        this.changeStandingsValues(game.home, 0, -1, 0, 1, -3, game.away, 0, 1, 0, -1, 3);
      } else if (homeGoals &#x3D;&#x3D;&#x3D; awayGoals &amp;&amp; homeGoals !&#x3D; null) {
        this.changeStandingsValues(game.home, 0, -1, 1, 0, -2, game.away, 0, 0, 1, -1, 1);
      } else if (homeGoals &#x3D;&#x3D;&#x3D; null || awayGoals &#x3D;&#x3D;&#x3D; null) {
        this.changeStandingsValues(game.home, -1, -1, 0, 0, -3, game.away, -1, 0, 0, -1, 0);
      }
    } else if (
      game.fulltimeHome &lt; game.fulltimeAway &amp;&amp;
      game.fulltimeHome !&#x3D; null
    ) {
      if (homeGoals &gt; awayGoals &amp;&amp; awayGoals !&#x3D; null) {
        this.changeStandingsValues(game.home, 0, 1, 0, -1, 3, game.away, 0, -1, 0, 1, -3);
      } else if (homeGoals &#x3D;&#x3D;&#x3D; awayGoals &amp;&amp; homeGoals !&#x3D; null) {
        this.changeStandingsValues(game.home, 0, 0, 1, -1, 1, game.away, 0, -1, 1, 0, -2);
      } else if (homeGoals &#x3D;&#x3D;&#x3D; null || awayGoals &#x3D;&#x3D;&#x3D; null) {
        this.changeStandingsValues(game.home, -1, 0, 0, -1, 0, game.away, -1, -1, 0, 0, -3);
      }
    } else if (
      game.fulltimeHome &#x3D;&#x3D;&#x3D; game.fulltimeAway &amp;&amp;
      game.fulltimeHome !&#x3D; null
    ) {
      if (homeGoals &gt; awayGoals &amp;&amp; awayGoals !&#x3D; null) {
        this.changeStandingsValues(game.home, 0, 1, -1, 0, 2, game.away, 0, 0, -1, 1, -1);
      } else if (homeGoals &lt; awayGoals &amp;&amp; homeGoals !&#x3D; null) {
        this.changeStandingsValues(game.home, 0, 0, -1, 1, -1, game.away, 0, 1, -1, 0, 2);
      } else if (homeGoals &#x3D;&#x3D;&#x3D; null || awayGoals &#x3D;&#x3D;&#x3D; null) {
        this.changeStandingsValues(game.home, -1, 0, -1, 0, -1, game.away, -1, 0, -1, 0, -1);
      }
    } else if (
      (game.fulltimeHome &#x3D;&#x3D;&#x3D; null &amp;&amp; game.fulltimeAway !&#x3D; null) ||
      (game.fulltimeHome !&#x3D; null &amp;&amp; game.fulltimeAway &#x3D;&#x3D;&#x3D; null) ||
      (game.fulltimeHome &#x3D;&#x3D;&#x3D; null &amp;&amp; game.fulltimeAway &#x3D;&#x3D;&#x3D; null)
    ) {
      if (homeGoals &gt; awayGoals &amp;&amp; awayGoals !&#x3D; null) {
        this.changeStandingsValues(game.home, 1, 1, 0, 0, 3, game.away, 1, 0, 0, 1, 0);
      } else if (homeGoals &lt; awayGoals &amp;&amp; homeGoals !&#x3D; null) {
        this.changeStandingsValues(game.home, 1, 0, 0, 1, 0, game.away, 1, 1, 0, 0, 3);
      } else if (homeGoals &#x3D;&#x3D;&#x3D; awayGoals &amp;&amp; homeGoals !&#x3D; null) {
        this.changeStandingsValues(game.home, 1, 0, 1, 0, 1, game.away, 1, 0, 1, 0, 1);
      }
    }

    this.changeStandingsGoals(game.home, homeGoals, game.fulltimeHome, game.away, awayGoals, game.fulltimeAway);

    this.games[index].fulltimeHome &#x3D; homeGoals;
    this.games[index].fulltimeAway &#x3D; awayGoals;
    this.allSeasonGames[this.leagueDetails.gameday - 1][index].fulltimeHome &#x3D; homeGoals;
    this.allSeasonGames[this.leagueDetails.gameday - 1][index].fulltimeAway &#x3D; awayGoals;

    this.gamesService.updateGames(this.games);
    this.gamesService.updateAllSeasonGames(this.allSeasonGames);
    this.sortStandings();
  }

  /**
   * Changes most values in the standings for the specific teams.
   *
   * @param {string} hName - The home team&#x27;s name
   * @param {number} hGP - The home team&#x27;s change of games played
   * @param {number} hW - The home team&#x27;s change of wins
   * @param {number} hD - The home team&#x27;s change of draws
   * @param {number} hL - The home team&#x27;s change of losses
   * @param {number} hP - The home team&#x27;s change of points
   * @param {string} aName - The away team&#x27;s name
   * @param {number} aGP - The away team&#x27;s change of games played
   * @param {number} aW - The away team&#x27;s change of wins
   * @param {number} aD - The away team&#x27;s change of draws
   * @param {number} aL - The away team&#x27;s change of losses
   * @param {number} aP - The away team&#x27;s change of points
   */
  changeStandingsValues(
    hName: string, hGP: number, hW: number, hD: number, hL: number, hP: number,
    aName: string, aGP: number, aW: number, aD: number, aL: number, aP: number
  ) {
    if (this.leagueDetails.gameday &gt; this.leagueDetails.gamedays) {
      return;
    }
    for (let i &#x3D; 0; i &lt; this.standings.length; i++) {
      const element &#x3D; this.standings[i];
      if (element.team &#x3D;&#x3D;&#x3D; hName) {
        this.standings[i].gamesPlayed +&#x3D; hGP;
        this.standings[i].wins +&#x3D; hW;
        this.standings[i].draws +&#x3D; hD;
        this.standings[i].losses +&#x3D; hL;
        this.standings[i].points +&#x3D; hP;
      } else if (element.team &#x3D;&#x3D;&#x3D; aName) {
        this.standings[i].gamesPlayed +&#x3D; aGP;
        this.standings[i].wins +&#x3D; aW;
        this.standings[i].draws +&#x3D; aD;
        this.standings[i].losses +&#x3D; aL;
        this.standings[i].points +&#x3D; aP;
      }
    }
  }

  /**
   * Changes the goals for and goals against values in the standings for the specific teams and calculates the goal difference for each team.
   *
   * @param {string} hName - The home team&#x27;s name
   * @param {number} hG - The home team&#x27;s new amount of goals scored
   * @param {number} hFG - The home team&#x27;s old amount of goals scored
   * @param {string} aName - The away team&#x27;s name
   * @param {number} aG - The away team&#x27;s new amount of goals scored
   * @param {number} aFG - The away team&#x27;s old amount of goals scored
   */
  changeStandingsGoals(hName: string, hG: number, hFG: number, aName: string, aG: number, aFG: number) {
    if (this.leagueDetails.gameday &gt; this.leagueDetails.gamedays) {
      return;
    }
    for (let i &#x3D; 0; i &lt; this.standings.length; i++) {
      const element &#x3D; this.standings[i];
      if (element.team &#x3D;&#x3D;&#x3D; hName) {
        this.standings[i].gf +&#x3D; hG - hFG;
        this.standings[i].ga +&#x3D; aG - aFG;
        this.standings[i].gd &#x3D; this.standings[i].gf - this.standings[i].ga;
      } else if (element.team &#x3D;&#x3D;&#x3D; aName) {
        this.standings[i].gf +&#x3D; aG - aFG;
        this.standings[i].ga +&#x3D; hG - hFG;
        this.standings[i].gd &#x3D; this.standings[i].gf - this.standings[i].ga;
      }
    }
  }

  /**
   * Changes the halftime for and goals against values in the standings for the specific teams.
   *
   * @param {number} index - The gameday index of the game
   * @param {number} homeHalftimeGoals - The home team&#x27;s amount of goals scored at halftime
   * @param {number} awayHalftimeGoals - The away team&#x27;s amount of goals scored at halftime
   */
  changeHalftime(
    index: number,
    homeHalftimeGoals: number,
    awayHalftimeGoals: number
  ) {
    this.games[index].halftimeHome &#x3D; homeHalftimeGoals;
    this.games[index].halftimeAway &#x3D; awayHalftimeGoals;

    this.allSeasonGames[this.leagueDetails.gameday - 1][index].halftimeHome &#x3D;
      homeHalftimeGoals;
    this.allSeasonGames[this.leagueDetails.gameday - 1][index].halftimeAway &#x3D;
      awayHalftimeGoals;

    this.gamesService.updateGames(this.games);
    this.gamesService.updateAllSeasonGames(this.allSeasonGames);
  }

  /**
   * Changes the displayed season of the league.
   *
   * @param {number} season - The now selected season
   */
  changeSeason(season: number) {
    let changeSeason &#x3D; +this.leagueDetails.season + season;
    let newSeason &#x3D; this.leagueDetails.leagueName
      .slice(0, -4)
      .concat(changeSeason.toString());

    this.leagueInfoService
      .doesLeagueExist(newSeason)
      .pipe(take(1))
      .subscribe((exists) &#x3D;&gt; {
        if (exists) {
          this.router.navigate([&#x60;../${newSeason}&#x60;], { relativeTo: this.route });
        }
      });
  }

  /**
   * Changes the displayed gameday for the league&#x27;s season.
   *
   * @param {number} index - The now selected gameday
   */
  changeGameday(index: number) {
    if (this.allSeasonGames[index - 1]) {
      window.scrollTo(0, 0);
      this.leagueDetails.gameday &#x3D; index;
      this.gamesService.changeGameday(this.leagueDetails.gameday);
      this.getAllGames();
    }
  }

  /**
   * Changes the stats in the games array.
   *
   * @param index - The index of the game
   * @param possessionHome - The amount of home possession in %
   * @param possessionAway - The amount of away possession in %
   * @param shotsHome - The home team&#x27;s amount of shots
   * @param shotsAway - The away team&#x27;s amount of shots
   * @param shotsOnGoalHome - The home team&#x27;s amount of shots on goal
   * @param shotsOnGoalAway - The away team&#x27;s amount of shots on goal
   * @param cornersHome - The home team&#x27;s amount of corners
   * @param cornersAway - The away team&#x27;s amount of corners
   */
  changeStats(index: number, possessionHome: number, possessionAway: number, shotsHome: number, shotsAway: number, shotsOnGoalHome: number, shotsOnGoalAway: number, cornersHome: number, cornersAway: number) {
    this.games[index].possessionHome &#x3D; possessionHome;
    this.games[index].possessionAway &#x3D; possessionAway;
    this.games[index].shotsHome &#x3D; shotsHome;
    this.games[index].shotsAway &#x3D; shotsAway;
    this.games[index].shotsOnGoalHome &#x3D; shotsOnGoalHome;
    this.games[index].shotsOnGoalAway &#x3D; shotsOnGoalAway;
    this.games[index].cornersHome &#x3D; cornersHome;
    this.games[index].cornersAway &#x3D; cornersAway;

    this.allSeasonGames[this.leagueDetails.gameday - 1][index].possessionHome &#x3D;
      possessionHome;
    this.allSeasonGames[this.leagueDetails.gameday - 1][index].possessionAway &#x3D;
      possessionAway;
    this.allSeasonGames[this.leagueDetails.gameday - 1][index].shotsHome &#x3D;
      shotsHome;
    this.allSeasonGames[this.leagueDetails.gameday - 1][index].shotsAway &#x3D;
      shotsAway;
    this.allSeasonGames[this.leagueDetails.gameday - 1][index].shotsOnGoalHome &#x3D;
      shotsOnGoalHome;
    this.allSeasonGames[this.leagueDetails.gameday - 1][index].shotsOnGoalAway &#x3D;
      shotsOnGoalAway;
    this.allSeasonGames[this.leagueDetails.gameday - 1][index].cornersHome &#x3D;
      cornersHome;
    this.allSeasonGames[this.leagueDetails.gameday - 1][index].cornersAway &#x3D;
      cornersAway;

    this.gamesService.updateGames(this.games);
    this.gamesService.updateAllSeasonGames(this.allSeasonGames);
  }

  /**
   * Closes the match details.
   */
  closeMatchDetails() {
    window.scrollTo(0, 0);
    setTimeout(() &#x3D;&gt; {
      this.showMatchDetails &#x3D; false;
    }, 500);
  }

  /**
   * Updates the league data to the current state in the firestore.
   */
  onUpdateLeagueData() {
    localStorage.removeItem(&#x60;${this.leagueDetails.leagueName}-games&#x60;);
    window.location.reload();
  }

  /**
   * Unsubscribes to all possible subscriptions if necessary.
   */
  ngOnDestroy(): void {
    this.currentMatchDetailsSubscription.unsubscribe();
    if (this.routeSubscription) {
      this.routeSubscription.unsubscribe();
    }
    if (this.currentTeamSubscription) {
      this.currentTeamSubscription.unsubscribe();
    }
  }
}
</code></pre>
    </div>
</div>







                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'leagueDetails.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
